<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Import Taxonomy from Text</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    button {
      background: #4147FF;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover { background: #3338dd; }
    textarea {
      width: 100%;
      height: 500px;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin: 15px 0;
    }
    #log {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success { color: #68B757; }
    .error { color: #ef4444; }
    .info { color: #4147FF; }
  </style>
</head>
<body>
  <h1>Import Taxonomy from Copied Text</h1>

  <p><strong>Paste the text you copied from Meta Tagger below:</strong></p>
  <textarea id="input" placeholder="Paste the full taxonomy text here..."></textarea>

  <button onclick="parseTaxonomy()">Parse & Import Taxonomy</button>

  <div id="log"></div>

  <script src="js/data.js"></script>
  <script src="js/utils.js"></script>
  <script>
    function log(msg, type = 'info') {
      const logDiv = document.getElementById('log');
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
      logDiv.innerHTML += `<span class="${className}">${msg}</span>\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function parseTaxonomy() {
      const text = document.getElementById('input').value;
      if (!text.trim()) {
        alert('Please paste the taxonomy text first!');
        return;
      }

      log('Parsing taxonomy text...', 'info');

      try {
        // Start with DEFAULT_TAXONOMY
        const newTax = JSON.parse(JSON.stringify(window.TaggerData.DEFAULT_TAXONOMY));
        const { smartCategorize, addToTaxonomy } = window.TaggerUtils;

        // Extract all keywords - they end with "close"
        const keywords = new Set();
        const matches = text.matchAll(/(\w[\w\s\-\.\(\)\&\'\+\/#°:,]+?)close/g);

        for (const match of matches) {
          const keyword = match[1].trim();
          if (keyword && keyword.length > 0 && keyword.length < 100) {
            keywords.add(keyword);
          }
        }

        log(`Found ${keywords.size} keywords`, 'success');

        let added = 0;
        keywords.forEach(keyword => {
          try {
            const path = smartCategorize({ value: keyword, type: 'keyword' });
            const kw = {
              id: `imported-${Math.random().toString(36).slice(2)}`,
              value: keyword,
              path: path,
              source: 'imported'
            };

            const result = addToTaxonomy(newTax, kw);
            Object.assign(newTax, result);
            added++;
          } catch (e) {
            // Skip problematic keywords
          }
        });

        // Save to localStorage
        localStorage.setItem('tagger_taxonomy', JSON.stringify(newTax));

        log('\n=== IMPORT COMPLETE ===', 'success');
        log(`✓ Successfully imported ${added} keywords!`, 'success');
        log('\n✓ Now refresh Meta Tagger to see all your keywords!', 'success');

      } catch (e) {
        log(`✗ Error: ${e.message}`, 'error');
        console.error(e);
      }
    }
  </script>
</body>
</html>
